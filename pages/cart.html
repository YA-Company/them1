<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سلة المشتريات - Brewly</title>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    
    <style>
        .quantity-btn {
            transition: all 0.2s ease;
        }
        .quantity-btn:hover {
            background-color: #fbbf24;
            color: white;
        }
        .cart-item {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .cart-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        .riyal-symbol {
            width: 16px;
            height: 16px;
            display: inline-block;
            vertical-align: baseline;
            margin-left: 2px;
        }
        .price-with-symbol {
            display: flex;
            align-items: center;
            gap: 4px;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Navbar placeholder -->
    <div id="navbar"></div>

    <!-- Main cart content -->
    <main class="p-4 md:p-10 bg-gray-100 flex-grow">
        <div class="max-w-7xl mx-auto">
            <!-- Breadcrumb -->
            <div class="text-sm text-gray-500 mb-6">
                <a href="/pages/index.html" class="hover:text-amber-600 transition">الرئيسية</a>
                &nbsp;&gt;&nbsp;
                <a href="/pages/products.html" class="hover:text-amber-600 transition">المنتجات</a>
                &nbsp;&gt;&nbsp;
                <span class="text-gray-700 font-medium">سلة المشتريات</span>
            </div>

            <!-- Cart title -->
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">سلة المشتريات</h1>
                <span class="text-gray-600" id="cart-items-count">0 منتج</span>
            </div>

            <!-- Empty cart message -->
            <div id="empty-cart" class="hidden bg-white rounded-lg shadow p-8 text-center">
                <i class="fas fa-shopping-cart text-5xl text-gray-300 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">سلة المشتريات فارغة</h3>
                <p class="text-gray-600 mb-6">لم تقم بإضافة أي منتجات إلى سلة المشتريات بعد.</p>
                <a href="/pages/products.html" 
                   class="inline-block bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-lg font-semibold transition">
                    تصفح المنتجات
                </a>
            </div>

            <!-- Cart with items -->
            <div id="cart-with-items" class="hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Cart Items -->
                    <div class="lg:col-span-2 space-y-4">
                        <!-- Cart items will be dynamically loaded here -->
                        <div id="cart-items-container"></div>
                    </div>

                    <!-- Order Summary -->
                    <div class="bg-white rounded-lg shadow p-6 h-fit sticky top-6">
                        <h2 class="font-semibold text-xl mb-6 pb-4 border-b">ملخص الطلب</h2>

                        <!-- Coupon section -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">كود الخصم</label>
                            <div class="flex">
                                <input
                                    type="text"
                                    id="coupon-code"
                                    placeholder="ادخل كود الخصم"
                                    class="flex-1 border border-gray-300 rounded-r px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500">
                                <button
                                    id="apply-coupon"
                                    class="bg-amber-400 hover:bg-amber-500 text-white px-4 rounded-l text-sm font-medium transition">
                                    تطبيق
                                </button>
                            </div>
                            <div id="coupon-message" class="mt-2 text-sm hidden"></div>
                        </div>

                        <!-- Prices summary -->
                        <div class="space-y-3 text-sm mb-6">
                            <div class="flex justify-between">
                                <span class="text-gray-600">مجموع المنتجات</span>
                                <div class="price-with-symbol">
                                    <span id="subtotal-price">0.00</span>
                                    <img src="https://www.sama.gov.sa/ar-sa/Currency/Documents/Saudi_Riyal_Symbol-1.png" 
                                         alt="ريال سعودي" 
                                         class="riyal-symbol">
                                </div>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">التوصيل</span>
                                <div class="price-with-symbol">
                                    <span id="shipping-price">0.00</span>
                                    <img src="https://www.sama.gov.sa/ar-sa/Currency/Documents/Saudi_Riyal_Symbol-1.png" 
                                         alt="ريال سعودي" 
                                         class="riyal-symbol">
                                </div>
                            </div>
                            <div class="flex justify-between hidden" id="discount-row">
                                <span class="text-gray-600">الخصم</span>
                                <div class="price-with-symbol text-green-600">
                                    -<span id="discount-price">0.00</span>
                                    <img src="https://www.sama.gov.sa/ar-sa/Currency/Documents/Saudi_Riyal_Symbol-1.png" 
                                         alt="ريال سعودي" 
                                         class="riyal-symbol">
                                </div>
                            </div>
                            <div class="flex justify-between font-semibold text-lg border-t pt-4 mt-4">
                                <span>الإجمالي</span>
                                <div class="price-with-symbol">
                                    <span id="total-price">0.00</span>
                                    <img src="https://www.sama.gov.sa/ar-sa/Currency/Documents/Saudi_Riyal_Symbol-1.png" 
                                         alt="ريال سعودي" 
                                         class="riyal-symbol">
                                </div>
                            </div>
                        </div>

                        <!-- Checkout button -->
                        <button
                            id="checkout-btn"
                            class="w-full bg-amber-500 hover:bg-amber-600 text-white py-3 rounded-lg font-semibold text-lg transition shadow-md hover:shadow-lg">
                            <i class="fas fa-lock ml-2"></i>
                            إتمام الطلب
                        </button>

                        <!-- Continue shopping -->
                        <a href="/pages/products.html" 
                           class="block w-full text-center mt-4 text-amber-600 hover:text-amber-700 font-medium">
                            ← متابعة التسوق
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer placeholder -->
    <div id="footer"></div>

    <script>
        // Load navbar and footer
        fetch("../partials/navbar.html")
            .then(res => res.text())
            .then(data => {
                document.getElementById("navbar").innerHTML = data;
                updateCartCountInNavbar();
            })
            .catch(error => console.error("Error loading navbar:", error));

        fetch("../partials/footer.html")
            .then(res => res.text())
            .then(data => document.getElementById("footer").innerHTML = data)
            .catch(error => console.error("Error loading footer:", error));

        // Cart state
        let cart = [];
        let appliedCoupon = null;

        // Load cart from localStorage
        function loadCartFromStorage() {
            const savedCart = localStorage.getItem('coffeeShopCart');
            if (savedCart) {
                try {
                    cart = JSON.parse(savedCart);
                    updateCartDisplay();
                } catch (error) {
                    console.error("Error loading cart:", error);
                    cart = [];
                }
            }
        }

        // Update cart count in navbar
        function updateCartCountInNavbar() {
            const cartCountElement = document.getElementById('cart-count');
            if (cartCountElement) {
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                cartCountElement.textContent = totalItems;
            }
        }

        // Update cart display
        function updateCartDisplay() {
            const emptyCartDiv = document.getElementById('empty-cart');
            const cartWithItemsDiv = document.getElementById('cart-with-items');
            const cartItemsCountElement = document.getElementById('cart-items-count');
            
            // Update cart count
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            if (cartItemsCountElement) {
                cartItemsCountElement.textContent = `${totalItems} منتج${totalItems !== 1 ? 'ات' : ''}`;
            }

            if (cart.length === 0) {
                // Show empty cart message
                emptyCartDiv.classList.remove('hidden');
                cartWithItemsDiv.classList.add('hidden');
            } else {
                // Show cart with items
                emptyCartDiv.classList.add('hidden');
                cartWithItemsDiv.classList.remove('hidden');
                
                // Render cart items
                renderCartItems();
                
                // Update order summary
                updateOrderSummary();
            }
            
            // Update navbar cart count
            updateCartCountInNavbar();
        }

        // Render cart items
        function renderCartItems() {
            const cartItemsContainer = document.getElementById('cart-items-container');
            cartItemsContainer.innerHTML = '';

            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'bg-white rounded-lg shadow p-4 md:p-6 cart-item';
                cartItem.setAttribute('data-product-id', item.id);
                
                cartItem.innerHTML = `
                    <div class="flex flex-col md:flex-row md:items-center gap-4 md:gap-6">
                        <!-- Product image -->
                        <div class="flex-shrink-0">
                            <img src="${item.image}" 
                                 alt="${item.name}" 
                                 class="w-24 h-24 md:w-32 md:h-32 object-contain rounded-lg">
                        </div>
                        
                        <!-- Product details -->
                        <div class="flex-grow">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-semibold text-lg text-gray-800">${item.name}</h3>
                                <button onclick="removeFromCart(${item.id})" 
                                        class="text-gray-400 hover:text-red-500 transition">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            
                            <p class="text-sm text-gray-500 mb-3">${item.category}</p>
                            
                            <!-- Size selection (if applicable) -->
                            <div class="mb-4">
                                <label class="text-sm text-gray-600 mb-1 block">الحجم:</label>
                                <select class="border rounded px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"
                                        onchange="updateItemSize(${item.id}, this.value)">
                                    <option value="medium" selected>الوسط</option>
                                    <option value="large">الكبير</option>
                                    <option value="xlarge">الكبير جداً</option>
                                </select>
                            </div>
                            
                            <!-- Price and quantity -->
                            <div class="flex justify-between items-center mt-4 pt-4 border-t">
                                <div>
                                    <div class="flex items-center gap-1">
                                        <span class="font-semibold text-amber-600 text-xl">${item.price.toFixed(2)}</span>
                                        <img src="https://www.sama.gov.sa/ar-sa/Currency/Documents/Saudi_Riyal_Symbol-1.png" 
                                             alt="ريال سعودي" 
                                             class="w-5 h-5">
                                    </div>
                                    <p class="text-sm text-gray-500">${item.price.toFixed(2)} × ${item.quantity}</p>
                                </div>
                                
                                <!-- Quantity controls -->
                                <div class="flex items-center border rounded-lg overflow-hidden">
                                    <button onclick="updateQuantity(${item.id}, -1)" 
                                            class="quantity-btn px-4 py-2 text-lg hover:bg-amber-50">
                                        -
                                    </button>
                                    <span class="px-4 py-2 border-x min-w-[50px] text-center font-medium">
                                        ${item.quantity}
                                    </span>
                                    <button onclick="updateQuantity(${item.id}, 1)" 
                                            class="quantity-btn px-4 py-2 text-lg hover:bg-amber-50">
                                        +
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                cartItemsContainer.appendChild(cartItem);
            });
        }

        // Update item quantity
        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                
                // Remove item if quantity is 0 or less
                if (item.quantity <= 0) {
                    cart = cart.filter(item => item.id !== productId);
                }
                
                // Save to localStorage
                localStorage.setItem('coffeeShopCart', JSON.stringify(cart));
                
                // Update display
                updateCartDisplay();
            }
        }

        // Remove item from cart
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('coffeeShopCart', JSON.stringify(cart));
            updateCartDisplay();
        }

        // Update item size (placeholder function)
        function updateItemSize(productId, size) {
            console.log(`Updated product ${productId} size to ${size}`);
            // Here you would update the item size in the cart
        }

        // Update order summary
        function updateOrderSummary() {
            // Calculate subtotal
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Calculate shipping (free for orders over 100)
            const shipping = subtotal >= 100 ? 0 : 15;
            
            // Calculate discount
            let discount = 0;
            if (appliedCoupon === 'BREWLY10') {
                discount = subtotal * 0.1; // 10% discount
            } else if (appliedCoupon === 'BREWLY20') {
                discount = subtotal * 0.2; // 20% discount
            }
            
            // Calculate total
            const total = subtotal + shipping - discount;
            
            // Update UI
            document.getElementById('subtotal-price').textContent = subtotal.toFixed(2);
            document.getElementById('shipping-price').textContent = shipping.toFixed(2);
            document.getElementById('discount-price').textContent = discount.toFixed(2);
            document.getElementById('total-price').textContent = total.toFixed(2);
            
            // Show/hide discount row
            const discountRow = document.getElementById('discount-row');
            if (discount > 0) {
                discountRow.classList.remove('hidden');
            } else {
                discountRow.classList.add('hidden');
            }
        }

        // Apply coupon
        document.getElementById('apply-coupon')?.addEventListener('click', function() {
            const couponCode = document.getElementById('coupon-code').value.toUpperCase();
            const couponMessage = document.getElementById('coupon-message');
            
            // Valid coupon codes
            const validCoupons = {
                'BREWLY10': '10% خصم على طلبك',
                'BREWLY20': '20% خصم على طلبك'
            };
            
            if (validCoupons[couponCode]) {
                appliedCoupon = couponCode;
                couponMessage.textContent = validCoupons[couponCode];
                couponMessage.className = 'mt-2 text-sm text-green-600';
                couponMessage.classList.remove('hidden');
            } else {
                appliedCoupon = null;
                couponMessage.textContent = 'كود الخصم غير صالح';
                couponMessage.className = 'mt-2 text-sm text-red-600';
                couponMessage.classList.remove('hidden');
            }
            
            // Update order summary
            updateOrderSummary();
            
            // Clear input
            document.getElementById('coupon-code').value = '';
        });

        // Checkout button
        document.getElementById('checkout-btn')?.addEventListener('click', function() {
            if (cart.length === 0) {
                alert('سلة المشتريات فارغة. أضف منتجات قبل إتمام الطلب.');
                return;
            }
            
            // Here you would redirect to checkout page or show checkout modal
            alert('سيتم توجيهك إلى صفحة الدفع قريباً...');
            console.log('Proceeding to checkout with:', cart);
        });

        // Allow pressing Enter to apply coupon
        document.getElementById('coupon-code')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('apply-coupon').click();
            }
        });

        // Initialize cart when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadCartFromStorage();
        });
    </script>
</body>
</html>